{"version":3,"file":"vue.js","sources":["../../src/util/index.js","../../src/observe/array.js","../../src/observe/index.js","../../src/state.js","../../src/init.js","../../src/index.js"],"sourcesContent":["export function isObject (data){\n  return typeof data === 'object' && data !== 'null'\n}\n\nexport function def(data, key, value){\n  Object.defineProperty(data, key, {\n      enumerable: false,\n      configurable: false,\n      value: value\n  })\n}","// 我要重写 数组的方法 push 、shift、 unshift、 pop、 reverse、sort 、splice\n\n\nlet oldArrayMethods = Array.prototype\n// 原型链查找  先查找重写的 arrayMethods ，重写的没有，会继续向上查找\n// value.__proto__ = arrayMethods\n// arrayMethods.__proto__ = oldArrayMethods\nexport let arrayMethods = Object.create(oldArrayMethods)\n\nconst methods = [\n  'push',\n  'shift',\n  'unshift',\n  'pop',\n  'sort',\n  'splice',\n  'reverse'\n]\n\nmethods.forEach(method => {\n  arrayMethods[method] = function(...args){\n\n    console.log('用户调用了 push')\n    const result = oldArrayMethods[method].apply(this, args) // 调用了原生的方法\n\n    // push 添加的元素 可能还是一个对象\n    let inserted;\n    let ob = this.__ob__;\n    switch(method){\n      case 'push':\n      case 'unshift':\n        inserted = args;\n        break;\n      case 'splice':\n        inserted = args.slice(2)\n\n      default:\n        break\n    }\n\n    if(inserted) ob.observeArray(inserted) // 将新增属性 继续观测\n\n    return result\n  }\n})\n\n\n\n\n\n\n","// 把 data 中数据 都是用 object.defineProperty 不能兼容 IE8 以下 Vue2 \nimport { isObject, def } from '../util/index'\nimport { arrayMethods } from './array.js'\n\nclass Observe{\n  constructor(value){\n    // vue 如果数据层次过多，需要递归的去解析 对象的属性 依次增加 set 和 get 方法\n    // vue3 使用了 proxy 提高了性能\n\n\n    def(value, '__ob__', this)\n    if(Array.isArray(value)){\n      // 如果是数组的话，不需要对 索引进行观察  因为有性能问题\n      // 前端开发一般通过 push 、 shift、unshift 操作数组  \n      value.__proto__ = arrayMethods\n\n      // 如果数组中是对象 ，我再监控\n      this.observeArray(value)\n    } else {\n     this.walk(value)\n    }\n  }\n\n  observeArray(value){\n    for(let i = 0; i < value.length; i +=1 ){\n      observe(value[i])\n    }\n  }\n\n\n  walk(data){\n    let keys = Object.keys(data);\n    keys.forEach(key => {\n      defineReactive(data, key, data[key])\n    })\n  }\n}\n\nfunction defineReactive(data, key, value){\n  observe(value) // 递归实现深度检测\n   Object.defineProperty(data, key, {\n     get(){\n      return value\n     },\n     set(newValue){\n         console.log(\"更新数据\")\n        if(newValue === value) return \n        observe(newValue) //用户设置的也可能是对象\n        console.log(\"值发生变化了\")\n        value = newValue\n     }\n   })\n}\n\n\nexport function observe(data){\n  let isObj = isObject(data)\n  if(!isObj){\n    return ;\n  }\n\n  return new Observe(data)\n\n}","import {observe} from './observe/index'\n\nexport function initState(vm){\n  const opts = vm.$options\n  // console.log(opts)\n  // vue 的数据来源 属性 方法 数据 计算属性 watch\n  if(opts.props){\n    initProps(vm) \n  }\n  if(opts.methods){\n    initMethod(vm)\n  }\n  if(opts.data){\n    initData(vm)\n  }\n  if(opts.computed){\n    initComputed(vm)\n  }\n  if(opts.watch){\n    initWatch(vm)\n  }\n}\n\nfunction initProps(){}\nfunction initMethod(){}\nfunction initData(vm){\n  // console.log(vm.$options.data)\n  let data = vm.$options.data\n  data = typeof data == 'function' ? data.call(vm) : data\n  vm._data = data\n  // 对象劫持 用户改变了对象，我希望可以得到通知 刷新页面\n  // MVVM 数据变化驱动视图变化\n  observe(data) // \n\n}\nfunction initComputed(){}\nfunction initWatch(){}\n\n\n\n\n","import { initState } from './state'\n\nexport function initMixin(Vue){\n  // 初始化流程\n  Vue.prototype._init = function (options) {\n    // console.log(options)\n    \n    // 数据劫持\n    const vm = this;\n    vm.$options = options\n\n    initState(vm) // 分割代码\n  };\n}\n\n","// vue 核心源码 ， 只是 vue 的一个声明\n\nimport {initMixin } from './init'\n\nfunction Vue(options){\n  // 进行 vue 的初始化\n  this._init(options)\n}\n\n// 通过引入文件的方式 给 vue 原型上添加方法\ninitMixin(Vue)\n\n\nexport default Vue"],"names":["isObject","data","def","key","value","Object","defineProperty","enumerable","configurable","oldArrayMethods","Array","prototype","arrayMethods","create","methods","forEach","method","console","log","args","result","apply","inserted","ob","__ob__","slice","observeArray","Observe","isArray","__proto__","walk","i","length","observe","keys","defineReactive","get","set","newValue","isObj","initState","vm","opts","$options","props","initData","computed","watch","call","_data","initMixin","Vue","_init","options"],"mappings":"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"}