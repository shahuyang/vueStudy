{"version":3,"file":"vue.js","sources":["../../src/util/index.js","../../src/observe/array.js","../../src/observe/index.js","../../src/state.js","../../src/compiler/index.js","../../src/init.js","../../src/index.js"],"sourcesContent":["export function isObject (data){\n  return typeof data === 'object' && data !== 'null'\n}\n\nexport function def(data, key, value){\n  Object.defineProperty(data, key, {\n      enumerable: false,\n      configurable: false,\n      value: value\n  })\n}","// 我要重写 数组的方法 push 、shift、 unshift、 pop、 reverse、sort 、splice\n\n\nlet oldArrayMethods = Array.prototype\n// 原型链查找  先查找重写的 arrayMethods ，重写的没有，会继续向上查找\n// value.__proto__ = arrayMethods\n// arrayMethods.__proto__ = oldArrayMethods\nexport let arrayMethods = Object.create(oldArrayMethods)\n\nconst methods = [\n  'push',\n  'shift',\n  'unshift',\n  'pop',\n  'sort',\n  'splice',\n  'reverse'\n]\n\nmethods.forEach(method => {\n  arrayMethods[method] = function(...args){\n\n    console.log('用户调用了 push')\n    const result = oldArrayMethods[method].apply(this, args) // 调用了原生的方法\n\n    // push 添加的元素 可能还是一个对象\n    let inserted;\n    let ob = this.__ob__;\n    switch(method){\n      case 'push':\n      case 'unshift':\n        inserted = args;\n        break;\n      case 'splice':\n        inserted = args.slice(2)\n\n      default:\n        break\n    }\n\n    if(inserted) ob.observeArray(inserted) // 将新增属性 继续观测\n\n    return result\n  }\n})\n\n\n\n\n\n\n","// 把 data 中数据 都是用 object.defineProperty 不能兼容 IE8 以下 Vue2 \nimport { isObject, def } from '../util/index'\nimport { arrayMethods } from './array.js'\n\nclass Observe{\n  constructor(value){\n    // vue 如果数据层次过多，需要递归的去解析 对象的属性 依次增加 set 和 get 方法\n    // vue3 使用了 proxy 提高了性能\n\n\n    def(value, '__ob__', this)\n    if(Array.isArray(value)){\n      // 如果是数组的话，不需要对 索引进行观察  因为有性能问题\n      // 前端开发一般通过 push 、 shift、unshift 操作数组  \n      value.__proto__ = arrayMethods\n\n      // 如果数组中是对象 ，我再监控\n      this.observeArray(value)\n    } else {\n     this.walk(value)\n    }\n  }\n\n  observeArray(value){\n    for(let i = 0; i < value.length; i +=1 ){\n      observe(value[i])\n    }\n  }\n\n\n  walk(data){\n    let keys = Object.keys(data);\n    keys.forEach(key => {\n      defineReactive(data, key, data[key])\n    })\n  }\n}\n\nfunction defineReactive(data, key, value){\n  observe(value) // 递归实现深度检测\n   Object.defineProperty(data, key, {\n     get(){\n      return value\n     },\n     set(newValue){\n         console.log(\"更新数据\")\n        if(newValue === value) return \n        observe(newValue) //用户设置的也可能是对象\n        console.log(\"值发生变化了\")\n        value = newValue\n     }\n   })\n}\n\n\nexport function observe(data){\n  let isObj = isObject(data)\n  if(!isObj){\n    return ;\n  }\n\n  return new Observe(data)\n\n}","import {observe} from './observe/index'\n\nexport function initState(vm){\n  const opts = vm.$options\n  // console.log(opts)\n  // vue 的数据来源 属性 方法 数据 计算属性 watch\n  if(opts.props){\n    initProps(vm) \n  }\n  if(opts.methods){\n    initMethod(vm)\n  }\n  if(opts.data){\n    initData(vm)\n  }\n  if(opts.computed){\n    initComputed(vm)\n  }\n  if(opts.watch){\n    initWatch(vm)\n  }\n}\n\nfunction initProps(){}\nfunction initMethod(){}\nfunction initData(vm){\n  // console.log(vm.$options.data)\n  let data = vm.$options.data\n  data = typeof data == 'function' ? data.call(vm) : data\n  vm._data = data\n  // 对象劫持 用户改变了对象，我希望可以得到通知 刷新页面\n  // MVVM 数据变化驱动视图变化\n  observe(data) // \n\n}\nfunction initComputed(){}\nfunction initWatch(){}\n\n\n\n\n","const ncname = `[a-zA-Z_][\\\\-\\\\.0-9_a-zA-Z]*`;    // abc-aaa\nconst qnameCapture = `((?:${ncname}\\\\:)?${ncname})`;  // <aaa:b>\nconst startTagOpen = new RegExp(`^<${qnameCapture}`); // 标签开头的正则 捕获的内容是标签名\nconst endTag = new RegExp(`^<\\\\/${qnameCapture}[^>]*>`); // 匹配标签结尾的 </div>\nconst attribute = /^\\s*([^\\s\"'<>\\/=]+)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>`]+)))?/; // 匹配属性的\nconst startTagClose = /^\\s*(\\/?)>/; // 匹配标签结束的 >\nconst defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g\n\nfunction parseHTML(html){\n    while(html){\n        let textEnd = html.indexOf('<');\n        if(textEnd === 0){\n            // 如果当前索引为 0 ，肯定是一个标签 开始标签 或 结束标签\n            let startTagMatch = parseStartTag() // 通过这个方法 获取匹配的结果  tagName   attrs\n            console.log(startTagMatch)\n            break\n        }\n    }\n\n    function advance(n){\n        html = html.substring(n)\n    }\n    function parseStartTag(){\n        let start = html.match(startTagOpen)\n        const match = {\n            tagName: start[1],\n            attrs: []\n        }\n        if(start){\n            advance( start[0].length)  // 将标签删除\n        }\n        let end, attr\n        // while 循环秒用  \n        while((!(end = html.match(startTagClose))) && (attr = html.match(attribute))){\n            console.log(attr)\n            match.attrs.push({\n                name: attr[1],\n                value: attr[3] || attr[4] || attr[5]\n            })\n            advance(attr[0].length)  // 将属性删除\n        }\n        if(end){\n            (advance(end[0].length))\n            return match\n        }\n    }\n}\n\n\n// ast 语法树 使用 对象 来描述原生语法    虚拟dom 使用 对象 描述 dom 节点\nexport function compileToFunction(template){\n    console.log(template)\n    let root = parseHTML (template)\n    return function render(){\n\n    }\n}\n\n\n/*{ <div id='app'>\n    <p>hello</p>\n</div> }*/\n\n// ast 语法树\n// let root = {\n//     tag: 'div',\n//     attrs: [{\n//         name: 'id',\n//         value: 'app'\n//     }],\n//     parent: null,\n//     type: 1,\n//     children: {\n//         tag: 'p',\n//         attrs: [],\n//         parent: root,\n//         type: 1,\n//         children: [{\n//             text: 'hello',\n//             type: 3\n//         }]\n//     }\n// }\n\n","import { initState } from './state'\nimport { compileToFunction } from './compiler/index.js' \n\nexport function initMixin(Vue){\n  // 初始化流程\n  Vue.prototype._init = function (options) {\n    // console.log(options)\n    \n    // 数据劫持\n    const vm = this;\n    vm.$options = options\n\n    initState(vm) // 分割代码\n\n\n    // 如果传入了 el 属性，需要将页面渲染出来， 就要实现挂载流程\n    if(vm.$options.el){\n      vm.$mount(vm.$options.el)\n    }\n  };\n\n  Vue.prototype.$mount = function(el){\n    const vm = this;\n    const options = vm.$mount;\n    el = document.querySelector(el)\n\n    // 默认 先会查找 有没有 render 没有 render 会用  template ， 没有 template 就用 el 中的内容\n    if(!options.render){\n      // 对模板进行编译\n      let template = options.template;\n      if(!template && el){\n        template = el.outerHTML\n        // 我们需要将 template 转化成  render 方法， vue 2.0 虚拟 dom\n      }\n      const render = compileToFunction(template)\n      options.render = render;\n\n    }\n  }\n}\n\n","// vue 核心源码 ， 只是 vue 的一个声明\n\nimport {initMixin } from './init'\n\nfunction Vue(options){\n  // 进行 vue 的初始化\n  this._init(options)\n}\n\n// 通过引入文件的方式 给 vue 原型上添加方法\ninitMixin(Vue)\n\n\nexport default Vue"],"names":["isObject","data","def","key","value","Object","defineProperty","enumerable","configurable","oldArrayMethods","Array","prototype","arrayMethods","create","methods","forEach","method","console","log","args","result","apply","inserted","ob","__ob__","slice","observeArray","Observe","isArray","__proto__","walk","i","length","observe","keys","defineReactive","get","set","newValue","isObj","initState","vm","opts","$options","props","initData","computed","watch","call","_data","ncname","qnameCapture","startTagOpen","RegExp","attribute","startTagClose","parseHTML","html","textEnd","indexOf","startTagMatch","parseStartTag","advance","n","substring","start","match","tagName","attrs","end","attr","push","name","compileToFunction","template","root","render","initMixin","Vue","_init","options","el","$mount","document","querySelector","outerHTML"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EAAO,SAASA,QAAT,CAAmBC,IAAnB,EAAwB;EAC7B,SAAO,QAAOA,IAAP,MAAgB,QAAhB,IAA4BA,IAAI,KAAK,MAA5C;EACD;EAEM,SAASC,GAAT,CAAaD,IAAb,EAAmBE,GAAnB,EAAwBC,KAAxB,EAA8B;EACnCC,EAAAA,MAAM,CAACC,cAAP,CAAsBL,IAAtB,EAA4BE,GAA5B,EAAiC;EAC7BI,IAAAA,UAAU,EAAE,KADiB;EAE7BC,IAAAA,YAAY,EAAE,KAFe;EAG7BJ,IAAAA,KAAK,EAAEA;EAHsB,GAAjC;EAKD;;ECVD;EAGA,IAAIK,eAAe,GAAGC,KAAK,CAACC,SAA5B;EAEA;EACA;;EACO,IAAIC,YAAY,GAAGP,MAAM,CAACQ,MAAP,CAAcJ,eAAd,CAAnB;EAEP,IAAMK,OAAO,GAAG,CACd,MADc,EAEd,OAFc,EAGd,SAHc,EAId,KAJc,EAKd,MALc,EAMd,QANc,EAOd,SAPc,CAAhB;EAUAA,OAAO,CAACC,OAAR,CAAgB,UAAAC,MAAM,EAAI;EACxBJ,EAAAA,YAAY,CAACI,MAAD,CAAZ,GAAuB,YAAiB;EAEtCC,IAAAA,OAAO,CAACC,GAAR,CAAY,YAAZ;;EAFsC,sCAALC,IAAK;EAALA,MAAAA,IAAK;EAAA;;EAGtC,QAAMC,MAAM,GAAGX,eAAe,CAACO,MAAD,CAAf,CAAwBK,KAAxB,CAA8B,IAA9B,EAAoCF,IAApC,CAAf,CAHsC;EAKtC;;EACA,QAAIG,QAAJ;EACA,QAAIC,EAAE,GAAG,KAAKC,MAAd;;EACA,YAAOR,MAAP;EACE,WAAK,MAAL;EACA,WAAK,SAAL;EACEM,QAAAA,QAAQ,GAAGH,IAAX;EACA;;EACF,WAAK,QAAL;EACEG,QAAAA,QAAQ,GAAGH,IAAI,CAACM,KAAL,CAAW,CAAX,CAAX;EANJ;;EAYA,QAAGH,QAAH,EAAaC,EAAE,CAACG,YAAH,CAAgBJ,QAAhB,EApByB;;EAsBtC,WAAOF,MAAP;EACD,GAvBD;EAwBD,CAzBD;;MCfMO;EACJ,mBAAYvB,KAAZ,EAAkB;EAAA;;EAChB;EACA;EAGAF,IAAAA,GAAG,CAACE,KAAD,EAAQ,QAAR,EAAkB,IAAlB,CAAH;;EACA,QAAGM,KAAK,CAACkB,OAAN,CAAcxB,KAAd,CAAH,EAAwB;EACtB;EACA;EACAA,MAAAA,KAAK,CAACyB,SAAN,GAAkBjB,YAAlB,CAHsB;;EAMtB,WAAKc,YAAL,CAAkBtB,KAAlB;EACD,KAPD,MAOO;EACN,WAAK0B,IAAL,CAAU1B,KAAV;EACA;EACF;;;;mCAEYA,OAAM;EACjB,WAAI,IAAI2B,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAG3B,KAAK,CAAC4B,MAAzB,EAAiCD,CAAC,IAAG,CAArC,EAAwC;EACtCE,QAAAA,OAAO,CAAC7B,KAAK,CAAC2B,CAAD,CAAN,CAAP;EACD;EACF;;;2BAGI9B,MAAK;EACR,UAAIiC,IAAI,GAAG7B,MAAM,CAAC6B,IAAP,CAAYjC,IAAZ,CAAX;EACAiC,MAAAA,IAAI,CAACnB,OAAL,CAAa,UAAAZ,GAAG,EAAI;EAClBgC,QAAAA,cAAc,CAAClC,IAAD,EAAOE,GAAP,EAAYF,IAAI,CAACE,GAAD,CAAhB,CAAd;EACD,OAFD;EAGD;;;;;;EAGH,SAASgC,cAAT,CAAwBlC,IAAxB,EAA8BE,GAA9B,EAAmCC,KAAnC,EAAyC;EACvC6B,EAAAA,OAAO,CAAC7B,KAAD,CAAP,CADuC;;EAEtCC,EAAAA,MAAM,CAACC,cAAP,CAAsBL,IAAtB,EAA4BE,GAA5B,EAAiC;EAC/BiC,IAAAA,GAD+B,iBAC1B;EACJ,aAAOhC,KAAP;EACA,KAH8B;EAI/BiC,IAAAA,GAJ+B,eAI3BC,QAJ2B,EAIlB;EACTrB,MAAAA,OAAO,CAACC,GAAR,CAAY,MAAZ;EACD,UAAGoB,QAAQ,KAAKlC,KAAhB,EAAuB;EACvB6B,MAAAA,OAAO,CAACK,QAAD,CAAP,CAHU;;EAIVrB,MAAAA,OAAO,CAACC,GAAR,CAAY,QAAZ;EACAd,MAAAA,KAAK,GAAGkC,QAAR;EACF;EAV8B,GAAjC;EAYF;;EAGM,SAASL,OAAT,CAAiBhC,IAAjB,EAAsB;EAC3B,MAAIsC,KAAK,GAAGvC,QAAQ,CAACC,IAAD,CAApB;;EACA,MAAG,CAACsC,KAAJ,EAAU;EACR;EACD;;EAED,SAAO,IAAIZ,OAAJ,CAAY1B,IAAZ,CAAP;EAED;;EC7DM,SAASuC,SAAT,CAAmBC,EAAnB,EAAsB;EAC3B,MAAMC,IAAI,GAAGD,EAAE,CAACE,QAAhB,CAD2B;EAG3B;;EACA,MAAGD,IAAI,CAACE,KAAR,EAAc;;EAGd,MAAGF,IAAI,CAAC5B,OAAR,EAAgB;;EAGhB,MAAG4B,IAAI,CAACzC,IAAR,EAAa;EACX4C,IAAAA,QAAQ,CAACJ,EAAD,CAAR;EACD;;EACD,MAAGC,IAAI,CAACI,QAAR,EAAiB;;EAGjB,MAAGJ,IAAI,CAACK,KAAR,EAAc;EAGf;;EAID,SAASF,QAAT,CAAkBJ,EAAlB,EAAqB;EACnB;EACA,MAAIxC,IAAI,GAAGwC,EAAE,CAACE,QAAH,CAAY1C,IAAvB;EACAA,EAAAA,IAAI,GAAG,OAAOA,IAAP,IAAe,UAAf,GAA4BA,IAAI,CAAC+C,IAAL,CAAUP,EAAV,CAA5B,GAA4CxC,IAAnD;EACAwC,EAAAA,EAAE,CAACQ,KAAH,GAAWhD,IAAX,CAJmB;EAMnB;;EACAgC,EAAAA,OAAO,CAAChC,IAAD,CAAP,CAPmB;EASpB;;EClCD,IAAMiD,MAAM,iCAAZ;;EACA,IAAMC,YAAY,iBAAUD,MAAV,kBAAwBA,MAAxB,MAAlB;;EACA,IAAME,YAAY,GAAG,IAAIC,MAAJ,aAAgBF,YAAhB,EAArB;;EAEA,IAAMG,SAAS,GAAG,2EAAlB;;EACA,IAAMC,aAAa,GAAG,YAAtB;;EAGA,SAASC,SAAT,CAAmBC,IAAnB,EAAwB;EACpB,SAAMA,IAAN,EAAW;EACP,QAAIC,OAAO,GAAGD,IAAI,CAACE,OAAL,CAAa,GAAb,CAAd;;EACA,QAAGD,OAAO,KAAK,CAAf,EAAiB;EACb;EACA,UAAIE,aAAa,GAAGC,aAAa,EAAjC,CAFa;;EAGb5C,MAAAA,OAAO,CAACC,GAAR,CAAY0C,aAAZ;EACA;EACH;EACJ;;EAED,WAASE,OAAT,CAAiBC,CAAjB,EAAmB;EACfN,IAAAA,IAAI,GAAGA,IAAI,CAACO,SAAL,CAAeD,CAAf,CAAP;EACH;;EACD,WAASF,aAAT,GAAwB;EACpB,QAAII,KAAK,GAAGR,IAAI,CAACS,KAAL,CAAWd,YAAX,CAAZ;EACA,QAAMc,KAAK,GAAG;EACVC,MAAAA,OAAO,EAAEF,KAAK,CAAC,CAAD,CADJ;EAEVG,MAAAA,KAAK,EAAE;EAFG,KAAd;;EAIA,QAAGH,KAAH,EAAS;EACLH,MAAAA,OAAO,CAAEG,KAAK,CAAC,CAAD,CAAL,CAASjC,MAAX,CAAP,CADK;EAER;;EACD,QAAIqC,GAAJ,EAASC,IAAT,CAToB;;EAWpB,WAAO,EAAED,GAAG,GAAGZ,IAAI,CAACS,KAAL,CAAWX,aAAX,CAAR,CAAD,KAAyCe,IAAI,GAAGb,IAAI,CAACS,KAAL,CAAWZ,SAAX,CAAhD,CAAN,EAA6E;EACzErC,MAAAA,OAAO,CAACC,GAAR,CAAYoD,IAAZ;EACAJ,MAAAA,KAAK,CAACE,KAAN,CAAYG,IAAZ,CAAiB;EACbC,QAAAA,IAAI,EAAEF,IAAI,CAAC,CAAD,CADG;EAEblE,QAAAA,KAAK,EAAEkE,IAAI,CAAC,CAAD,CAAJ,IAAWA,IAAI,CAAC,CAAD,CAAf,IAAsBA,IAAI,CAAC,CAAD;EAFpB,OAAjB;EAIAR,MAAAA,OAAO,CAACQ,IAAI,CAAC,CAAD,CAAJ,CAAQtC,MAAT,CAAP,CANyE;EAO5E;;EACD,QAAGqC,GAAH,EAAO;EACFP,MAAAA,OAAO,CAACO,GAAG,CAAC,CAAD,CAAH,CAAOrC,MAAR,CAAR;EACA,aAAOkC,KAAP;EACH;EACJ;EACJ;;;EAIM,SAASO,iBAAT,CAA2BC,QAA3B,EAAoC;EACvCzD,EAAAA,OAAO,CAACC,GAAR,CAAYwD,QAAZ;EACA,MAAIC,IAAI,GAAGnB,SAAS,CAAEkB,QAAF,CAApB;EACA,SAAO,SAASE,MAAT,GAAiB,EAAxB;EAGH;EAGD;EACA;EACA;EAEA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;EC/EO,SAASC,SAAT,CAAmBC,GAAnB,EAAuB;EAC5B;EACAA,EAAAA,GAAG,CAACnE,SAAJ,CAAcoE,KAAd,GAAsB,UAAUC,OAAV,EAAmB;EACvC;EAEA;EACA,QAAMvC,EAAE,GAAG,IAAX;EACAA,IAAAA,EAAE,CAACE,QAAH,GAAcqC,OAAd;EAEAxC,IAAAA,SAAS,CAACC,EAAD,CAAT,CAPuC;EAUvC;;EACA,QAAGA,EAAE,CAACE,QAAH,CAAYsC,EAAf,EAAkB;EAChBxC,MAAAA,EAAE,CAACyC,MAAH,CAAUzC,EAAE,CAACE,QAAH,CAAYsC,EAAtB;EACD;EACF,GAdD;;EAgBAH,EAAAA,GAAG,CAACnE,SAAJ,CAAcuE,MAAd,GAAuB,UAASD,EAAT,EAAY;EACjC,QAAMxC,EAAE,GAAG,IAAX;EACA,QAAMuC,OAAO,GAAGvC,EAAE,CAACyC,MAAnB;EACAD,IAAAA,EAAE,GAAGE,QAAQ,CAACC,aAAT,CAAuBH,EAAvB,CAAL,CAHiC;;EAMjC,QAAG,CAACD,OAAO,CAACJ,MAAZ,EAAmB;EACjB;EACA,UAAIF,QAAQ,GAAGM,OAAO,CAACN,QAAvB;;EACA,UAAG,CAACA,QAAD,IAAaO,EAAhB,EAAmB;EACjBP,QAAAA,QAAQ,GAAGO,EAAE,CAACI,SAAd,CADiB;EAGlB;;EACD,UAAMT,MAAM,GAAGH,iBAAiB,CAACC,QAAD,CAAhC;EACAM,MAAAA,OAAO,CAACJ,MAAR,GAAiBA,MAAjB;EAED;EACF,GAjBD;EAkBD;;ECvCD;;EAIA,SAASE,GAAT,CAAaE,OAAb,EAAqB;EACnB;EACA,OAAKD,KAAL,CAAWC,OAAX;EACD;;;EAGDH,SAAS,CAACC,GAAD,CAAT;;;;;;;;"}